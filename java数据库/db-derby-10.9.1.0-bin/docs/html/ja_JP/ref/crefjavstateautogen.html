<?xml version="1.0" encoding="UTF-8"?>
<!--
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="ja" xml:lang="ja">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
<meta name="copyright" content="(C) Copyright 2005" />
<meta name="DC.rights.owner" content="(C) Copyright 2005" />
<meta content="public" name="security" />
<meta content="index,follow" name="Robots" />
<meta http-equiv="PICS-Label" content='(PICS-1.1 "http://www.icra.org/ratingsv02.html" l gen true r (cz 1 lz 1 nz 1 oz 1 vz 1) "http://www.rsac.org/ratingsv01.html" l gen true r (n 0 s 0 v 0 l 0) "http://www.classify.org/safesurf/" l gen true r (SS~~000 1))' />
<meta content="concept" name="DC.Type" />
<meta name="DC.Title" content="Autogenerated keys" />
<meta content="autogenerated keys" name="DC.subject" />
<meta content="autogenerated keys" name="keywords" />
<meta scheme="URI" name="DC.Relation" content="rrefjdbcjavasqlstatement30.html" />
<meta content="XHTML" name="DC.Format" />
<meta content="crefjavstateautogen" name="DC.Identifier" />
<meta content="ja" name="DC.Language" />
<link href="commonltr.css" type="text/css" rel="stylesheet" />
<title>Autogenerated keys</title>
</head>
<body id="crefjavstateautogen"><a name="crefjavstateautogen"><!-- --></a>


<h1 class="topictitle1">Autogenerated keys</h1>


<div>
<p />

<p>JDBC 3.0のキー自動生成に関する機能により、索引の一部あるいは既定値の割り当てられた列から値を取得する方法があります。
<span>Derby</span>には自動増分の機能があって、この機能により、データベースにより自動的に増分された値をとる列を、ユーザは表に定義することができます。
JDBC 3.0では<em>Statement.getGeneratedKeys</em>メソッドを呼んでこの種類の列の値を取得することができます。このメソッドは値に自動生成キーをとる列を持つ<em>ResultSet</em>を返します。
また<em>getGeneratedKeys</em>から返された<em>ResultSet</em>オブジェクトにて<em>ResultSet.getMetaData</em>メソッドを呼んで、<a href="rrefidentityvallocal.html#rrefidentityvallocal">IDENTITY_VAL_LOCAL</a>から返るのと同様な<em>ResultSetMetaData</em>オブジェクトを得ることもできます。</p>


<p> ユーザは<em>Connection.prepareStatement</em>メソッドや、<em>Statement.execute</em>メソッド、<em>Statement.executeUpdate</em>メソッドの二つ目の引数に、以下に示すいずれかの値を渡すことで、自動生成された列を取得できます。</p>

<ul>
<li>自動生成されたキーを取得できるようにする定数。具体的には<samp class="codeph">Statement.RETURN_GENERATED_KEYS</samp>です。</li>

<li>挿入する行の列の内、取得できるようにする列名の配列。配列にある列名のいずれも自動生成される列で無ければ、<span>Derby</span> は例外を挙げます。(なおこの引数は、<span>Derby</span>では組み込みドライバでのみ利用可能です。) </li>

<li>挿入する行の列の内、取得できるようにする列位置の配列。配列のいずれも自動生成される列で<em>なければ</em>、<span>Derby</span>は例外を挙げます。(この引数は<span>Derby</span>では組み込みドライバでのみ利用可能です。) </li>

</ul>

<div class="section"><h2 class="sectiontitle">例</h2> 
<p>以下のように定義されたTABLE1という表があるとします。</p>
 
<pre>CREATE TABLE TABLE1 (C11 int, C12 int GENERATED ALWAYS AS IDENTITY)
</pre>
 
<p>以下の三つのコードは同じことを行います。すなわち、TABLE1に挿入された<samp class="codeph">C12</samp> の値を持つ、<em>ResultSet</em>を生成します。
</p>
 
<p>コード 1:</p>
 <pre>
Statement stmt = conn.createStatement(); 
stmt.execute(
    "INSERT INTO TABLE1 (C11) VALUES (1)",
    Statement.RETURN_GENERATED_KEYS);
ResultSet rs = stmt.getGeneratedKeys();
</pre>
 
<p>コード 2:</p>
 <pre>
Statement stmt = conn.createStatement(); 
String [] colNames = new String [] { "C12" };
stmt.execute(
    "INSERT INTO TABLE1 (C11) VALUES (1)",
    colNames);
ResultSet rs = stmt.getGeneratedKeys();
</pre>
 
<p>コード 3:</p>
 <pre>
Statement stmt = conn.createStatement(); 
int [] colIndexes = new int [] { 2 };
stmt.execute(
    "INSERT INTO TABLE1 (C11) VALUES (1)",
    colIndexes);
ResultSet rs = stmt.getGeneratedKeys();
</pre>
 
<p>もし自動生成された列を取得できるようにする指定がなければ、
<em>Statement.getGeneratedKeys</em>への呼び出しはnullの<em>ResultSet</em>を返します。</p>
 </div>


</div>

<div>
<div class="familylinks">
<div class="parentlink"><strong>親トピック:</strong> <a href="rrefjdbcjavasqlstatement30.html" title="">java.sql.Statementインターフェイス: JDBC 3.0で利用可能なメソッド</a></div>
</div>
</div>

</body>
</html>
